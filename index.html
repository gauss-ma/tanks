<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Emis. Tanques - FAUBA</title>

	<!-- GoogleFonts (Raleway) -->
	<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>
	
	<!-- jQuery 3.6.0 -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<!-- Bootstrap 3.4.1 JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> 
	<!-- Bootstap 3.4.1 CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<!-- Bootsrap Icons -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

	<!-- call css -->
	<link rel="stylesheet" href="css/style.css">
	<!-- call js -->

</head>

<body>
<header>
	<h1>Herramienta de calculo de emisiones en tanques.</h1>
	El proposito de esta herramienta es calcular emisiones de tanques de almacenamiento de hidrocarburos.  <br>
	Los calculos están basados en el documento <a href="https://www3.epa.gov/ttn/chief/ap42/ch07/final/ch07s01.pdf" target="_blank" title="https://www3.epa.gov/ttn/chief/ap42/ch07/final/ch07s01.pdf"> AP-42 (06/2020), Section 7.1</a>.<br>
</header>

<section>

	<h2>Identificación</h2>

	<div class="form-group">
	  	<label for="usr"> Nombre del Proyecto:</label>
	  	<input type="text" class="form-control" id="usrID">
	</div>
	<div id="" class="fomr-group" name="">
	  	<label for="usr"> Ubicación:</label>
	  	<input type="text" class="form-control" id="location">
	</div>
	<div class="form-group">
	  	<label for="usr"> Empresa/Institución:</label>
	  	<input type="text" class="form-control" id="company">
	</div>
	<div class="form-group">
		 <label for="comment">Descripción:</label>
		<textarea class="form-control" rows="3" id="description"></textarea>
	</div>


	<h2>Sitio de estudio		</h2>
	<div class="form-group">
	  	<label for="meteoSite">Ciudad más cercana a ubicación del proyecto:</label>
		<select id="meteoSite" onChange="loadMeteorologicalParameters(this.value); showMeteoParams();" class="form-control">
			<!-- Aca van los nombres de los sitios donde tenemos la climatología -->
		</select>
	</div>
	

	<div id="meteoParameters" class="hidden">


	</div>

	<h3>Opciones de cálculo </h3>

	<label for="unitsInput" >Sistema de unidades de entrada:</label>&#160;
	<label class="radio-inline"><input type="radio" name="unitsInput" value="Imperial" checked>Imperial</label>
	<label class="radio-inline"><input type="radio" name="unitsInput" value="MKS">Internacional (mks)</label>
	
	<br>

	<label for="unitsOutput" >Sistema de unidades de salida:</label>&#160;
    <label class="radio-inline"><input type="radio" name="unitsOutput" value="Imperial" checked>Imperial</label>
    <label class="radio-inline"><input type="radio" name="unitsOutput" value="MKS">Internacional (mks)</label>

	<br>


	<br><br>
	<button type="button" class="btn disabled" id="addTankButton" onclick="addTank();"> + Agregar tanque.</button>
	<br>


	
	<!-- ACA EMPIEZA LA SECCION DE INFO DE TANQUES -->
	<div id="tanks" class="hidden">

	<!-- Acá van los tanques -->
	<!-- Por ahora 1 solo    -->


	<div id="1" class="tank">
		<hr>
        <!--button type="button" class="btn-close disabled" onClick="removeTank(${div.id})">X</button-->

	<span class="pull-right clickable close-icon" onClick="removeTank(1)"><i class="bi bi-x-circle"></i></span>

        <h1 id="tankName" contenteditable="true"> Tanque 1</h1>
	<h3 id="tankDescription" contenteditable="true"> Descripción de tanque 1 </h3>
	
	<div>
	        <label class="" for="tankType">Tipo de tanque:</label>&#160;
        	<label class="radio-inline"><input type="radio" name="tankType" value="VFR" onClick="habilitarInputs(this.value);" >Vertical Techo Fijo  </label>
        	<label class="radio-inline"><input type="radio" name="tankType" value="HFR" onClick="habilitarInputs(this.value);" >Horizontal</label>
        	<label class="radio-inline"><input type="radio" name="tankType" value="IFR" onClick="habilitarInputs(this.value);" >Interno Plataforma Flotante y Techo Fijo </label>
			<label class="radio-inline"><input type="radio" name="tankType" value="EFR" onClick="habilitarInputs(this.value);" >Externo Plataforma Flotante  </label>
			<label class="radio-inline"><input type="radio" name="tankType" value="DEFR" onClick="habilitarInputs(this.value);" >Externo Plataforma Flotante y Domo Fijo </label>
	</div>
	<br>
	
	<div id="verticalTanksDimensions" class="hidden">
		<h2>Dimensiones del tanque</h2>
		<label for="shellHeight">Altura pared <span class="unitImp">(ft)</span> <span class="unitSI">(m)</span>:</label>
                <input type="number" id="shellHeight" name="shellHeight" min="0" title="" form="formulario"><br>
		<label for="diameter">Diámetro <span class="unitImp">(ft)</span> <span class="unitSI">(m)</span>:</label>
        		<input type="number" id="diameter" name="diameter" min="0" title="" form="formulario"><br>
		<label for="minLiquidHeight">Altura Mín. Líquido <span class="unitImp">(ft)</span> <span class="unitSI">(m)</span>:</label>
				<input type="number" id="minLiquidHeight" name="minLiquidHeight" min="0" title="" form="formulario"><br>
		<label for="avgLiquidHeight">Altura Prom. Líquido <span class="unitImp">(ft)</span> <span class="unitSI">(m)</span>:</label>
				<input type="number" id="avgLiquidHeight" name="avgLiquidHeight" min="0" title="" form="formulario"><br>
		<label for="maxLiquidHeight">Altura Máx. Líquido <span class="unitImp">(ft)</span> <span class="unitSI">(m)</span>:</label>
				<input type="number" id="maxLiquidHeight" name="maxLiquidHeight" min="0" title="" form="formulario"><br>
	</div>
	
	<div id="horizontalTanksDimensions" class="hidden">
		<h2>Dimensiones del tanque</h2>
		<label for="shellHeight">Largo <span class="unitImp">(ft)</span> <span class="unitSI">(m)</span>:</label>
	        <input type="number" id="shellHeight" name="shellHeight" min="0" title="" form="formulario"><br>
		<label for="Diameter">Diámetro <span class="unitImp">(ft)</span> <span class="unitSI">(m)</span>:</label>
	        <input type="number" id="Diameter" name="Diameter" min="0" title="" form="formulario"><br>			
	</div>

    <div id="insulation" class="VFR hidden">
		<h2>Aislamiento térmico (VFR)</h2>
            <label for="insulated">Tank Insulation:</label>
            <select class="form-control" id="insulated" form="formulario" title="">
                    <option disabled selected value>Select from list</option>
                    <option value="none">None</option>
                    <option value="shell">Shell Only</option>
                    <option value="full">Shell and Roof</option>
                    <option value="underground">Underground</option>
            </select>
    </div>
	<div id="insulation" class="HFR hidden">
		<h2>Aislamiento térmico (HFR)</h2>
		<label for="insulated">Tank Insulation:</label>
		<select class="form-control" id="insulated" form="formulario" title="">
				<option disabled selected value>Select from list</option>
				<option value="none">None</option>
				<option value="full">Insulated</option>
				<option value="underground">Underground</option>
		</select>
	</div>

	
	<div id="heating" class="hidden">
		<h2>Calentamiento</h2>
		<label class="checkbox-inline"><input type="checkbox" value="" id="heated" onClick="addHeating()">Considerar calentamiento</label>
	</div>
	<div id="tankHeating" class="hidden">
		<label for="cyclesPerYear">Cycles pey year:</label>
	    <input type="number" id="cyclesPerYear" name="cyclesPerYear" min="0" title="" form="formulario"><br>
		<label for="minBulkTemp">Min. Bulk Temp. <span class="unitImp">(ºR)</span> <span class="unitSI">(ºC)</span>:</label>
	    <input type="number" id="minBulkTemp" name="minBulkTemp" min="0" title="" form="formulario"><br>			
		<label for="maxBulkTemp">Max. Bulk Temp. <span class="unitImp">(ºR)</span> <span class="unitSI">(ºC)</span>:</label>
	    <input type="number" id="maxBulkTemp" name="maxBulkTemp" min="0" title="" form="formulario"><br>			
	</div>



	<div class="tankShell">
		
		<h2>Cuerpo del tanque</h2>
	
		<div class="">
		<label  for="paintShell">Pintura:</label>
		<select class="form-control" id="paintShell" form="formulario">
			<option disabled selected value>Seleccionar una opción...</option>
		</select>
		</div>
		<br>
		<div class="">
		<label  for="conditionShell">Estado:</label>
		<select class="form-control" id="conditionShell" form="formulario">
			<option disabled selected value>Seleccionar una opción...</option>
			<option value="New">Nuevo</option>
			<option value="Average">Intermedio</option>
			<option value="Aged">Antigüo</option>
		</select>
		</div>
				
	<div class="tankRoof">
		<h2>Techo del tanque</h2>

		<div id="roofVFR" class="VFR hidden">
		<label  for="roofType">Tipo de techo:</label>
		<select class="form-control" id="roofType" onchange="fixedRoofType()" form="formulario">
			<option disabled selected value>Seleccionar una opción...</option>
			<option value="Cone">Cono</option>
			<option value="Dome">Domo</option>
		</select>
		</div>

		<div class="">
		<label  for="paintRoof">Pintura:</label>
		<select class="form-control" id="paintRoof" form="formulario">
			<option disabled selected value>Seleccionar una opción...</option>
		</select>
		</div>
		<br>
		<div class="">
		<label  for="conditionRoof">Estado:</label>
		<select class="form-control" id="conditionRoof" form="formulario">
			<option disabled selected value>Seleccionar una opción...</option>
			<option value="New">Nuevo</option>
			<option value="Average">Intermedio</option>
			<option value="Aged">Antigüo</option>
		</select>
		</div>

		<h3> Dimensiones del techo </h3>
		<!--roof height-->
		<div id="divRoofH" class="">
			<label for="roofH">Altura (ft):</label>
			<input type="number" id="roofH" name="roofH" min="0" onchange="fixedRoofHeight()" form="formulario" title="">
		</div>
		<!--roof slope for cone roofs-->
		<div id="divSlope" class="">				
			<label  for="fixedRoofSlope">Pendiente (ft/ft):</label>
			<input  type="number" id="fixedRoofSlope" name="fixedRoofSlope" min="0" title="" form="formulario" step="0.001">
		</div>
		<div id="divRadius" class="">
		<!--roof radius for dome roofs-->
			<label  for="fixedRoofRad">Radio Radius (ft):</label>
			<input  type="number" id="fixedRoofRad" name="fixedRoofRad" min="0" title="" form="formulario">
		</div>
		<br>
	
		<div>

		
		<br>
	</div>

	<div class="Input6" id="Input6">	
		
		<h2>Respiración y venteos</h2>
			<!--breather vent vacuum setting-->
			<label for="setVac">Vacuum Setting (psig):</label>
			<input type="number" id="setVac" name="setVac" value=-0.03 title="" form="formulario" onchange="checkPres()" step="0.01">
			<br>
			<!--breather vent pressure setting-->
			<label for="setPres">Pressure Setting (psig):</label>
			<input type="number" id="setPres" name="setPres" value=0.03 title="" form="formulario" onchange="checkPres()" step="0.01">
			<br>

			<!--vapor space gauge pressure-->
			<div id="divGaugePres">
				<label for="gaugePres">Vapor Space Gauge Pressure (psig):</label>
				<input type="number" id="gaugePres" name="gaugePres" min="0" value=0 title="" form="formulario">
			</div><br>
	</div>	

	<div name="tankContent">
		<h2>Contenido del tanque</h2>
		<!--Tank contents drop down box-->
		<label for="LiqInput" >Origen datos:</label>
		<select id="LiqInput" onchange="SelectLiquidInput()" form="formulario">
			<option disabled selected value>Seleccionar una opción...</option>	
			<option value="Database">Base de datos</option>
			<option value="Manual">Entrada manual</option>
		</select>
		
		<br>
		<div id="divLiqType">
			<label for="liqType" >Tipo de líquido:</label>
			<select id="liqType" onchange="liquidCategory=this.value;loadLiquidList(this.value)" form="formulario">
				<option disabled selected value>Seleccionar una opción...</option>
				<option value="Crude Oils">Petróleos crudos</option>
				<option value="Refined Petroleum Liquids">Petróleos refinados</option>
				<option value="Other organic liquids">Otros líquidos orgánicos</option>
			</select>
		</div>
		<div id="divtankContents">
			<label for="tankContents">Nombre:</label>
			<select id="tankContents" onchange="getLiqProp(this.value, liquidCategory), showLiqProp()" form="formulario">
				<option disabled selected value>Select from list</option>
			</select>
		</div>
		<div id="divCalcMethod">
			<label for="calcMethod" >TVP Calc. Method:</label>
			<select id="calcMethod" onchange="formatLiqInput()" form="formulario">
				<option disabled selected value>Select from list</option>
				<option value="RVP">RVP</option>
				<option value="Coef">Antoine's Coeficients</option>
			</select>
		</div>
		<div id="liqProp" class="hidden"></div>	
	
	</div>
	</div>




<hr>
</div>	<!-- end TANKS -->

	<h2>Opciones de salida</h2>
	<div>
	<b>a.</b> Seleccione tipo de informe a generar.<br><br>
		<!--Determine detailed or summary output type-->
		<label for="outputType">Tipo de informe:</label>
		<select class="form-control" id="outputType" title="" form="formulario">
			<option disabled selected value>Seleccionar..</option>
			<option value="Summary">Resumido</option>
			<option value="Detailed">Detallado</option>
		</select>
	</div>
	<br>
	<div>
	<b>b.</b> Hace click en "Calcular" para ver el reporte de salida.<br><br>
	 	<button type="button" class="btn btn-primary btn-lg" id="calcButton" name="calcButton" onclick="main()" >Calcular</button>
	 	<button type="button" class="btn disabled    btn-lg" id="calcButton" name="calcButton" onclick="reset()" >Reset</button>
	 	<button type="button" class="btn disabled    btn-lg" id="calcButton" name="calcButton" onclick="validarTodo()" >Debug</button>
	
	</div>
	<br>

</div>
</section>





<footer>

</footer>

<!-- call css -->

<style> /*ESTO ES TEMPORAL, cuando termine lo mudamos a ./css/style.css */
#tanks > .tank > *{
	color:#303030;
};

#tanks > .tank {
	padding-top: 10pt;
	padding-top: 20pt;
	border-top:3pt solid #505050;
};

</style>
<!-- call js -->

<script src="js/tablas/meteo.js"> 	//DB meteorología.	         </script>
<script src="js/tablas/chems.js"> 	//DB compuestos puros.	         </script>
<script src="js/tablas/petroleum.js">	//DB líquidos de petroleo.       </script>
<script src="js/tablas/paint.js"> 	//DB pinturas.		         </script>
<script src="js/tablas/rimSeal.js"> 	//DB tipos de sellos	         </script>
<script src="js/tablas/deckFittings.js">//DB accesorios plataforma flotante  </script>

<script src="js/calculos.js">     	//Cálculos del AP-42.            </script>
<script src="js/main.js"> 	  	//MAIN			         </script>

<script src="js/output.js"> 		//Funciones para armar reporte   </script>
<script src="js/validaciones.js">   	//Script para hacer validaciones </script>


<script>//Interactividad de la pagina 

	appendMetData();        //Cargar sitios meteorologia.

	showMeteoParams=function(){
		 
		meteoList=`
		<h3> Climatología del sitio </h3>

                    <label for="MinTemp">Temp. Mín. (&deg;R):</label>
		    <input id="MinTemp" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${m.minAmbientTemp}><br>

                    <label for="MaxTemp">Temp. Máx (&deg;R):</label>
		    <input id="MaxTemp" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${m.maxAmbientTemp}><br>

                    <label for="Wind">Viento (mph):</label>
                    <input id="Wind" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${m.u}><br>

                    <label for="Insolation" class="longLabel">Insolación (Btu/ft<sup>2</sup>&middot;d):</label>
		    <input id="Insolation" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${m.insolation}><br>

                    <label for="atmPres">Presión Atm. (psia):</label>
                    <input id="atmPres" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${m.atmPressure}><br>
				`;

		$("#meteoParameters").html(meteoList);
		$("#meteoParameters").removeClass("hidden");


	};


	habilitarInputs=function(tankType){

		//seccion de dimensiones:
		if (tankType == "HFR" ) {
			$("#verticalTanksDimensions").addClass('hidden');		
			$("#horizontalTanksDimensions").removeClass('hidden');	
		} else {
			$("#horizontalTanksDimensions").addClass('hidden');		
			$("#verticalTanksDimensions").removeClass('hidden');	
		};

		//sección de aislamiento
		$("#insulation*").addClass('hidden');		//esconder todos
		$("#insulation."+tankType).removeClass('hidden');	//mostrar solo el que nos interesa.

		//sección de calentamiento
		if (tankType == "VFR" || tankType =="HFR" ) {
			$("#heating").removeClass('hidden');	//mostrar
		} else {
			$("#heating").addClass('hidden');		//esconder
		};
	
		//sección de tipo de techo
		$("#roofVFR").addClass('hidden');
		$("#roofVFR."+tankType).removeClass('hidden');

		//sección características del sello
		
		//sección de accesorios

		//sección de costuras de la plataforma flotante

		
	};

	addHeating=function() {
		if ($("#heated").is(":checked")==true) {
		$("#tankHeating").removeClass("hidden");
		} else {
			$("#tankHeating").addClass("hidden");
		};
	};

	appendPaintData();		//cargar los datos de la pintura

	loadLiquidList=function(liqType) {
		if (liqType=="Other organic liquids") {
			appendCompoundData();
		} else if (liqType=="Crude Oils") {
			appendCrudeOils();
		} else if (liqType=="Refined Petroleum Liquids") {
			appendRefinedOils();
		};
	};	

	getLiqProp=function(tankContent,liqType) {
		if (liqType == "Other organic liquids"){ 	
			compoundName=tankContent;
			c=loadCompoundParameters(compoundName);
		} else {
			liquidName=tankContent;
			c=loadLiquidParameters(liquidName);
	};
	};

	showLiqProp=function() {
		if (liquidCategory=="Other organic liquids") {
		liqList=`
		<br><u>Características del líquido</u><br><br>
			<label for="molW">Peso Molecular (lb/lb-mol):</label>
			<input id="molW" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${c.molWeight}><br>
			<label for="liqD">Densidad líquido (lb/gal):</label>
			<input id="liqD" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${c.liqDensity}><br>
		`
		} else {
		liqList=`
		<br><u>Características del líquido</u><br><br>
			<label for="VapMW">Peso Mol. Vapor (lb/lb-mol):</label>
			<input id="VapMW" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${c.vapMolWeight}><br>
			<label for="LiqMW">Peso Mol. Líquido (lb/lb-mol):</label>
			<input id="LiqMW" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${c.liqMolWeight}><br>
			<label for="liqD">Densidad líquido (lb/gal):</label>
			<input id="liqD" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${c.liqDensity}><br>
			<label for="Slope">Pendiente Curva Destil. (&deg;F/vol%):</label>
			<input id="Slope" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${c.slope}><br>
			<label for="TVP">Presión de vapor a 60&deg;F (psia):</label>
			<input id="TVP" type="text" form="formulario" readonly style="cursor: not-allowed;" value=${c.vaporPressure}><br>
		`
		}
		$("#liqProp").html(liqList);
		$("#liqProp").removeClass("hidden");	
	}

	//Esto es para incorporar calculo de varios tanques. Lo dejamos en stand-by.
	let tanksCounter=0;
	addTank=function(){
		tanksCounter++;
	
		//if(tanksCounter==1){
			$("#tanks").removeClass('hidden');		
			
		//	//agregar nuevo tanque:
		//	div=document.createElement("div");
		//	div.id=tanksCounter;
		//	div.className+="tank";
		//	div.innerHTML+=`
		//	<span class="pull-right clickable close-icon badge bg-primary rounded-pill" onClick="removeTank(${div.id})"><i class="bi bi-x-circle"></i></span>
		//	<h1 id="tankName${div.id}" contenteditable="true"> Tanque ${div.id}</h1>
		//	`;
	
		//	document.getElementById("tanks").appendChild(div);
		//}
		//else{console.log("Solo se permite 1 tanque");}
	};
	
	removeTank=function(id){
		document.getElementById("tanks").children.namedItem(id).remove();
		//document.getElementById("tanks").children[id].remove();
	};
	

</script>

</body>
</html>
